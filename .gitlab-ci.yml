stages:
  - node-build
  - test
  - docker-build

node-build:
 image: node:10.23.1-alpine
 stage: node-build
 script:
   - npm run get-dependencies --prefix app
   - npm run client:build --prefix app

test:
  image: node:10.23.1-alpine
  stage: test
  script:
    - npm run test --prefix app/client

cache:
 paths:
   - node_modules/

docker-build:
 image: docker:latest
 stage: docker-build
 services:
   - docker:dind
 script:
#todo test
   - ls
   - rm -rf app/client/
   - docker build . --tag app
#todo test
   - docker images